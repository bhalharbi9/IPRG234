<!doctype html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Flexbox Lab</title>
<style>
  :root{
    --bg:#0b1220; --text:#e5e7eb; --muted:#94a3b8; --border:#223047;
    --ok:#22c55e; --bad:#ef4444; --warn:#f59e0b;
    --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono","CourierNew", monospace;
  }
  *{box-sizing:border-box}
  body{margin:0;padding:14px;background:var(--bg);color:var(--text);font-family:system-ui,-apple-system,"Segoe UI",Tahoma,Arial}
  header{background:linear-gradient(180deg,rgba(255,255,255,.05),rgba(255,255,255,.02));border:1px solid var(--border);border-radius:16px;padding:14px 16px;margin-bottom:12px}
  header h1{margin:0 0 6px 0;font-size:18px}
  header p{margin:0;color:var(--muted);font-size:13px;line-height:1.7}

  .layout{display:grid;grid-template-columns:1fr;gap:12px}
  @media(min-width:1000px){.layout{grid-template-columns:1.05fr .95fr}}

  .panel{background:rgba(255,255,255,.03);border:1px solid var(--border);border-radius:16px;overflow:hidden}
  .hd{padding:12px 14px;border-bottom:1px solid var(--border);display:flex;justify-content:space-between;align-items:center;gap:10px;flex-wrap:wrap}
  .title{font-weight:1000;font-size:14px}
  .sub{color:var(--muted);font-size:12px;font-weight:900}
  .bd{padding:12px}

  .controls{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
  button{border:1px solid var(--border);background:rgba(255,255,255,.06);color:var(--text);padding:8px 12px;border-radius:12px;cursor:pointer;font-weight:1000;font-size:13px}
  button:hover{background:rgba(255,255,255,.10)}
  button.primary{border-color:rgba(34,197,94,.45);background:rgba(34,197,94,.14)}
  button.danger{border-color:rgba(239,68,68,.45);background:rgba(239,68,68,.12)}
  button.small{padding:6px 10px;border-radius:999px;font-size:12px}

  .auto{display:flex;align-items:center;gap:8px;padding:6px 10px;border-radius:999px;border:1px solid var(--border);background:rgba(255,255,255,.04);font-size:12px;font-weight:1000;user-select:none}
  .toggle{width:44px;height:24px;border-radius:999px;border:1px solid var(--border);background:rgba(255,255,255,.08);position:relative;cursor:pointer}
  .toggle::after{content:"";position:absolute;width:18px;height:18px;border-radius:999px;top:2px;right:2px;background:rgba(255,255,255,.85);transition:all .2s ease}
  .toggle.on{background:rgba(34,197,94,.18);border-color:rgba(34,197,94,.45)}
  .toggle.on::after{right:22px;background:rgba(34,197,94,.95)}

  .scorebar{width:100%;display:grid;gap:8px;margin-top:10px;padding-top:10px;border-top:1px solid var(--border)}
  .scoretop{display:flex;align-items:center;justify-content:space-between;gap:10px;flex-wrap:wrap}
  .scoretop .big{font-weight:1000}
  .scoretop .big span{color:var(--muted);font-weight:1000;font-size:12px;margin-right:6px}
  .progress{height:12px;border-radius:999px;background:rgba(255,255,255,.08);overflow:hidden;border:1px solid var(--border)}
  .progress .fill{height:100%;width:0%;background:linear-gradient(90deg,rgba(34,197,94,.9),rgba(245,158,11,.9));transition:width .25s ease}

  .chips{display:flex;gap:8px;flex-wrap:wrap}
  .chip{border:1px solid var(--border);background:rgba(255,255,255,.04);border-radius:999px;padding:4px 10px;font-size:12px;font-weight:1000;display:flex;align-items:center;gap:8px;user-select:none}
  .dot{width:8px;height:8px;border-radius:999px;background:var(--warn)}
  .chip.ok .dot{background:var(--ok)}
  .chip.bad .dot{background:var(--bad)}
  .chip.ok{border-color:rgba(34,197,94,.45);background:rgba(34,197,94,.10)}
  .chip.bad{border-color:rgba(239,68,68,.45);background:rgba(239,68,68,.08)}

  textarea{
    width:100%;
    min-height:430px;
    resize:vertical;
    border-radius:14px;
    border:1px solid var(--border);
    background:rgba(0,0,0,.25);
    color:var(--text);
    padding:12px;
    font-family:var(--mono);
    font-size:12.5px;
    line-height:1.6;
    outline:none;

    /* âœ… Ù…Ø­Ø±Ø± CSS LTR */
    direction:ltr;
    text-align:left;
    unicode-bidi: plaintext;
    font-variant-ligatures:none;
    tab-size:2;
  }

  iframe{width:100%;height:780px;border:0;background:#fff}

  .qs{display:grid;gap:10px;margin-top:10px}
  .qcard{border:1px solid var(--border);border-radius:14px;background:rgba(255,255,255,.03);padding:10px 12px}
  .qcard b{display:block;margin-bottom:6px}
  .qcard ul{margin:0;padding-right:18px;color:var(--muted);font-size:12px;line-height:1.7}

  .results{display:grid;gap:10px;margin-top:12px}
  .r{border:1px solid var(--border);background:rgba(255,255,255,.03);border-radius:14px;padding:10px 12px}
  .r .top{display:flex;justify-content:space-between;gap:10px;align-items:flex-start;flex-wrap:wrap}
  .r .name{font-weight:1000;font-size:13px}
  .r .score{font-weight:1000;font-size:13px}
  .r .msg{color:var(--muted);font-size:12px;margin-top:6px;line-height:1.7}
  .okBox{border-color:rgba(34,197,94,.55);background:rgba(34,197,94,.10)}
  .badBox{border-color:rgba(239,68,68,.55);background:rgba(239,68,68,.08)}

  code{font-family:var(--mono);font-size:12px}
</style>
</head>
<body>

<header>
  <center><h1>Flexbox Lab</h1></center>
  
</header>

<div class="layout">
  <!-- LEFT -->
  <section class="panel">
    <div class="hd">
      <div>
        <div class="title">CSS Editor</div>
        <div class="sub">Ø§ÙƒØªØ¨ Ø®ØµØ§Ø¦Øµ flexbox Ø¯Ø§Ø®Ù„ TODO ÙÙ‚Ø·</div>
      </div>

      <div class="controls">
        <button class="primary" id="btnApply">ØªØ·Ø¨ÙŠÙ‚</button>
        <button class="primary" id="btnCheck">ØªØ­Ù‚Ù‚ Ø§Ù„Ø¢Ù†</button>
        <button class="danger" id="btnResetAll">Ø¥Ø¹Ø§Ø¯Ø© Ø¶Ø¨Ø· Ø§Ù„ÙƒÙ„</button>

        <div class="auto">
          <span>ØªÙ‚ÙŠÙŠÙ… ÙÙˆØ±ÙŠ</span>
          <div class="toggle on" id="autoToggle"></div>
        </div>
      </div>

      <div class="scorebar">
        <div class="scoretop">
          <div class="big"><span>Ø§Ù„Ù†ØªÙŠØ¬Ø©:</span> <span id="scoreText">0/11</span></div>
          <div class="big"><span>Ø§Ù„Ù†Ø³Ø¨Ø©:</span> <span id="percentText">0%</span></div>
        </div>
        <div class="progress"><div class="fill" id="progressFill"></div></div>
        <div class="chips" id="chips"></div>
      </div>
    </div>

    <div class="bd">
      <div class="qs" aria-label="Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø£Ø³Ø¦Ù„Ø©">
        <div class="qcard">
          <b>Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø£Ø³Ø¦Ù„Ø© (ÙƒÙ„ Ø³Ø¤Ø§Ù„ 1 Ø¯Ø±Ø¬Ø©)</b>
          <ul>
            <li>Ø³1: ÙØ¹Ù‘Ù„ Flexbox Ø¹Ù„Ù‰ Ø§Ù„Ø­Ø§ÙˆÙŠØ©.</li>
            <li>Ø³2: ØºÙŠÙ‘Ø± Ø§ØªØ¬Ø§Ù‡ ØªØ±ØªÙŠØ¨ Ø§Ù„Ø¹Ù†Ø§ØµØ± (Ù…Ø­ÙˆØ± Ø±Ø¦ÙŠØ³ÙŠ Ù…Ø®ØªÙ„Ù).</li>
            <li>Ø³3: Ø§Ø¬Ø¹Ù„ Ø§Ù„Ø¹Ù†Ø§ØµØ± ØªÙ†ØªÙ‚Ù„ Ù„Ø³Ø·Ø± Ø¬Ø¯ÙŠØ¯ Ø¹Ù†Ø¯ Ø¶ÙŠÙ‚ Ø§Ù„Ù…Ø³Ø§Ø­Ø©.</li>
            <li>Ø³4: Ø§Ø¬Ù…Ø¹ Ø§ØªØ¬Ø§Ù‡ + Ø§Ù„ØªÙØ§Ù Ù…Ø¹Ù‹Ø§ (Ø§Ø®ØªØµØ§Ø±).</li>
            <li>Ø³5: ÙˆØ²Ù‘Ø¹ Ø§Ù„Ù…Ø³Ø§ÙØ§Øª Ø¨ÙŠÙ† Ø§Ù„Ø¹Ù†Ø§ØµØ± Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø­ÙˆØ± Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ.</li>
            <li>Ø³6: Ø§Ø¶Ø¨Ø· Ù…Ø­Ø§Ø°Ø§Ø© Ø§Ù„Ø¹Ù†Ø§ØµØ± Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø­ÙˆØ± Ø§Ù„Ø¹Ø±Ø¶ÙŠ.</li>
            <li>Ø³7: ØºÙŠÙ‘Ø± ØªØ±ØªÙŠØ¨ Ø¹Ù†ØµØ± ÙˆØ§Ø­Ø¯ Ù„ÙŠØµØ¨Ø­ ÙÙŠ Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©.</li>
            <li>Ø³8: Ø­Ø¯Ù‘Ø¯ Ø­Ø¬Ù…Ù‹Ø§ Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠÙ‹Ø§ Ù„Ù„Ø¹Ù†Ø§ØµØ± Ù…Ø¹ Ø¥Ù…ÙƒØ§Ù†ÙŠØ© Ø§Ù„Ø§Ù„ØªÙØ§Ù.</li>
            <li>Ø³9: Ø§Ø¬Ø¹Ù„ Ø¹Ù†ØµØ±Ù‹Ø§ ÙŠØªÙ…Ø¯Ø¯ Ø£ÙƒØ«Ø± Ù…Ù† ØºÙŠØ±Ù‡.</li>
            <li>Ø³10: Ø§Ù…Ù†Ø¹ Ø¹Ù†ØµØ±Ù‹Ø§ Ù…Ù† Ø§Ù„Ø§Ù†ÙƒÙ…Ø§Ø´ Ø¹Ù†Ø¯ Ø¶ÙŠÙ‚ Ø§Ù„Ù…Ø³Ø§Ø­Ø©.</li>
            <li>Ø³11: ØºÙŠÙ‘Ø± Ù…Ø­Ø§Ø°Ø§Ø© Ø¹Ù†ØµØ± ÙˆØ§Ø­Ø¯ ÙÙ‚Ø· Ø¨Ø´ÙƒÙ„ Ù…Ø³ØªÙ‚Ù„.</li>
          </ul>
        </div>
      </div>

      <textarea id="cssInput" spellcheck="false"></textarea>
      <div class="results" id="results"></div>
    </div>
  </section>

  <!-- RIGHT -->
  <section class="panel">
    <div class="hd">
      <div>
        <div class="title">Ø§Ù„Ù…Ø¹Ø§ÙŠÙ†Ø©</div>
        <div class="sub">HTML Ø«Ø§Ø¨Øª â€” ÙŠØªØºÙŠØ± ÙÙ‚Ø· Ø¹Ø¨Ø± CSS</div>
      </div>
    </div>
    <div class="bd" style="padding:0;">
      <iframe id="preview"></iframe>
    </div>
  </section>
</div>

<script>
/* ===== Locked HTML inside iframe ===== */
const lockedHTML = `
<!doctype html><html lang="ar" dir="rtl"><head>
<meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1">
<style>
  body{font-family:system-ui;margin:0;padding:16px;background:#f6f7fb;color:#0f172a;}
  h2{margin:0 0 10px 0;font-size:16px}
  p{margin:0 0 12px 0;color:#475569;font-size:13px;line-height:1.7}
  .wrap{display:grid;gap:14px;grid-template-columns:1fr;}
  @media(min-width:900px){.wrap{grid-template-columns:1fr 1fr;}}
  .q{background:#fff;border:1px solid #e5e7eb;border-radius:16px;padding:12px;}
  .t{display:flex;justify-content:space-between;align-items:center;gap:10px;margin-bottom:8px;flex-wrap:wrap;}
  .t b{font-size:14px}
  .t span{font-size:12px;color:#64748b;border:1px solid #e5e7eb;padding:2px 10px;border-radius:999px;background:#f8fafc}
  .demo{border:2px dashed #94a3b8;border-radius:12px;padding:12px;min-height:150px;gap:10px;}
  .item{padding:10px 12px;border-radius:12px;color:#fff;font-weight:800;display:inline-block;min-width:80px;text-align:center;}
  .c1{background:#111827}.c2{background:#2563eb}.c3{background:#16a34a}
  .c4{background:#f59e0b;color:#111}.c5{background:#7c3aed}.c6{background:#ef4444}
  .tall{padding:24px 12px}.w200{width:200px}
</style>
<style id="studentCSS"></style>
</head><body>
<h2>Ø£Ø³Ø¦Ù„Ø© Flexbox (Ø§Ù„Ù…Ø¹Ø§ÙŠÙ†Ø©)</h2>
<p>Ù‡Ø°Ù‡ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª ØªÙØ³ØªØ®Ø¯Ù… Ù„Ù„ØªÙ‚ÙŠÙŠÙ….</p>
<div class="wrap">
  <section class="q q1"><div class="t"><b>Ø³1</b><span>ØªÙØ¹ÙŠÙ„ Flex</span></div>
    <div class="demo"><div class="item c1">1</div><div class="item c2">2</div><div class="item c3">3</div></div></section>

  <section class="q q2"><div class="t"><b>Ø³2</b><span>ØªØºÙŠÙŠØ± Ø§Ù„Ø§ØªØ¬Ø§Ù‡</span></div>
    <div class="demo"><div class="item c1">1</div><div class="item c2">2</div><div class="item c3">3</div></div></section>

  <section class="q q3"><div class="t"><b>Ø³3</b><span>Ø§Ù„ØªÙØ§Ù Ø§Ù„Ø¹Ù†Ø§ØµØ±</span></div>
    <div class="demo"><div class="item c2 w200">A</div><div class="item c2 w200">B</div><div class="item c2 w200">C</div>
      <div class="item c2 w200">D</div><div class="item c2 w200">E</div></div></section>

  <section class="q q4"><div class="t"><b>Ø³4</b><span>Ø§Ø®ØªØµØ§Ø± Ø§ØªØ¬Ø§Ù‡+Ø§Ù„ØªÙØ§Ù</span></div>
    <div class="demo" style="height:220px;"><div class="item c4">1</div><div class="item c4">2</div><div class="item c4">3</div><div class="item c4">4</div><div class="item c4">5</div></div></section>

  <section class="q q5"><div class="t"><b>Ø³5</b><span>ØªÙˆØ²ÙŠØ¹ Ù…Ø³Ø§ÙØ§Øª</span></div>
    <div class="demo"><div class="item c1">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</div><div class="item c1">Ø§Ù„Ø®Ø¯Ù…Ø§Øª</div><div class="item c1">ØªÙˆØ§ØµÙ„</div></div></section>

  <section class="q q6"><div class="t"><b>Ø³6</b><span>Ù…Ø­Ø§Ø°Ø§Ø© Ø¹Ø±Ø¶ÙŠØ©</span></div>
    <div class="demo" style="min-height:200px;"><div class="item c5">ØµØºÙŠØ±</div><div class="item c5 tall">Ø£Ø·ÙˆÙ„</div><div class="item c5">ØµØºÙŠØ±</div></div></section>

  <section class="q q7"><div class="t"><b>Ø³7</b><span>ØªØºÙŠÙŠØ± ØªØ±ØªÙŠØ¨ Ø¹Ù†ØµØ±</span></div>
    <div class="demo"><div class="item c3">1</div><div class="item c3">2</div><div class="item c3">3</div><div class="item c3">4</div></div></section>

  <section class="q q8"><div class="t"><b>Ø³8</b><span>Ø­Ø¬Ù… Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠ</span></div>
    <div class="demo"><div class="item c6">A</div><div class="item c6">B</div><div class="item c6">C</div><div class="item c6">D</div></div></section>

  <section class="q q9"><div class="t"><b>Ø³9</b><span>Ø¹Ù†ØµØ± ÙŠØªÙ…Ø¯Ø¯ Ø£ÙƒØ«Ø±</span></div>
    <div class="demo"><div class="item c2 first">Ø§Ù„Ø£ÙˆÙ„</div><div class="item c2">Ø§Ù„Ø«Ø§Ù†ÙŠ</div><div class="item c2">Ø§Ù„Ø«Ø§Ù„Ø«</div></div></section>

  <section class="q q10"><div class="t"><b>Ø³10</b><span>Ù…Ù†Ø¹ Ø§Ù„Ø§Ù†ÙƒÙ…Ø§Ø´</span></div>
    <div class="demo" style="max-width:420px;"><div class="item c1">ÙŠØ³Ø§Ø±</div><div class="item c1 mid">ÙˆØ³Ø·</div><div class="item c1">ÙŠÙ…ÙŠÙ†</div></div></section>

  <section class="q q11"><div class="t"><b>Ø³11</b><span>Ù…Ø­Ø§Ø°Ø§Ø© Ø¹Ù†ØµØ± ÙˆØ§Ø­Ø¯</span></div>
    <div class="demo" style="min-height:200px;"><div class="item c5">1</div><div class="item c5">2</div><div class="item c5 special">3</div><div class="item c5">4</div></div></section>
</div></body></html>
`;

/* âœ… Starter CSS (Ø¨Ø¯ÙˆÙ† Ø®ØµØ§Ø¦Øµ Ø¬Ø§Ù‡Ø²Ø©) */
const starterCSS = `/* =========================
   Flexbox Lab (Student CSS)
   âœ… Ø§ÙƒØªØ¨ Ø®ØµØ§Ø¦Øµ flexbox Ø¨Ù†ÙØ³Ùƒ Ø¯Ø§Ø®Ù„ TODO
   ========================= */

/* Ø³1 */
.q1 .demo{
  /* TODO */
}

/* Ø³2 */
.q2 .demo{
  /* TODO */
}

/* Ø³3 */
.q3 .demo{
  /* TODO */
}

/* Ø³4 */
.q4 .demo{
  /* TODO */
}

/* Ø³5 */
.q5 .demo{
  /* TODO */
}

/* Ø³6 */
.q6 .demo{
  /* TODO */
}

/* Ø³7 */
.q7 .demo{
  /* TODO */
}
.q7 .demo .item:nth-child(4){
  /* TODO */
}

/* Ø³8 */
.q8 .demo{
  /* TODO */
}
.q8 .demo .item{
  /* TODO */
}

/* Ø³9 */
.q9 .demo{
  /* TODO */
}
.q9 .demo .item{
  /* TODO */
}
.q9 .demo .item.first{
  /* TODO */
}

/* Ø³10 */
.q10 .demo{
  /* TODO */
}
.q10 .demo .item.mid{
  /* TODO */
}

/* Ø³11 */
.q11 .demo{
  /* TODO */
}
.q11 .demo .item.special{
  /* TODO */
}
`;

const iframe = document.getElementById('preview');
const cssInput = document.getElementById('cssInput');
const resultsEl = document.getElementById('results');
const chipsEl = document.getElementById('chips');
const scoreText = document.getElementById('scoreText');
const percentText = document.getElementById('percentText');
const progressFill = document.getElementById('progressFill');
const autoToggle = document.getElementById('autoToggle');

let liveEnabled = true;
let debounceTimer = null;
const MAX = 11;
let iframeReady = false;

cssInput.value = starterCSS;

/* âœ… Ø¨Ù„ÙˆÙƒØ§Øª Ø§Ù„Ø£Ø³Ø¦Ù„Ø© (Ù„Ø§Ø²Ù… ØªÙƒÙˆÙ† Ù‚Ø¨Ù„ hasAttempted) */
const questionBlocks = [
  { id:'q1', start:'/* Ø³1 */', end:'/* Ø³2 */' },
  { id:'q2', start:'/* Ø³2 */', end:'/* Ø³3 */' },
  { id:'q3', start:'/* Ø³3 */', end:'/* Ø³4 */' },
  { id:'q4', start:'/* Ø³4 */', end:'/* Ø³5 */' },
  { id:'q5', start:'/* Ø³5 */', end:'/* Ø³6 */' },
  { id:'q6', start:'/* Ø³6 */', end:'/* Ø³7 */' },
  { id:'q7', start:'/* Ø³7 */', end:'/* Ø³8 */' },
  { id:'q8', start:'/* Ø³8 */', end:'/* Ø³9 */' },
  { id:'q9', start:'/* Ø³9 */', end:'/* Ø³10 */' },
  { id:'q10', start:'/* Ø³10 */', end:'/* Ø³11 */' },
  { id:'q11', start:'/* Ø³11 */', end:null },
];

function extractBlock(source, startMarker, endMarker){
  const s = source.indexOf(startMarker);
  if (s === -1) return null;
  const e = endMarker ? source.indexOf(endMarker, s + startMarker.length) : source.length;
  if (e === -1) return null;
  return { start:s, end:e, text: source.slice(s, e) };
}

/* âœ… Ù‡Ù„ Ø­Ø§ÙˆÙ„ Ø§Ù„Ø·Ø§Ù„Ø¨ ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„Ø³Ø¤Ø§Ù„ØŸ (ÙƒØªØ¨ Ø£ÙŠ Ø´ÙŠØ¡ ØºÙŠØ± ØªØ¹Ù„ÙŠÙ‚/Ù…Ø³Ø§ÙØ§Øª) */
function hasAttempted(qid){
  const qb = questionBlocks.find(x => x.id === qid);
  if (!qb) return false;

  const block = extractBlock(cssInput.value, qb.start, qb.end);
  if (!block) return false;

  // Ø§Ø­Ø°Ù Ø§Ù„ØªØ¹Ù„ÙŠÙ‚Ø§Øª
  const noComments = block.text.replace(/\/\*[\s\S]*?\*\//g, '');

  // Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© = ÙˆØ¬ÙˆØ¯ "ØªØµØ±ÙŠØ­ CSS" Ø¯Ø§Ø®Ù„ Ø£ÙŠ Ù‚ÙˆØ³ { ... }
  // Ù…Ø«Ù„: display:flex  Ø£Ùˆ  justify-content: space-between;
  const declRegex = /\{[^}]*:[^}]+?\}/m;

  return declRegex.test(noComments);
}


function setStudentCSS(css){
  const doc = iframe.contentDocument;
  if (!doc) return;
  const tag = doc.getElementById('studentCSS');
  if (!tag) return;
  tag.textContent = css;
}
function apply(){
  if (!iframeReady) return;
  setStudentCSS(cssInput.value);
}

/* âœ… ØªÙ„Ù…ÙŠØ­Ø§Øª Ø¹Ø§Ù…Ø© ÙÙ‚Ø· */
function generalHint(qid){
  switch(qid){
    case 'q1': return 'ØªÙ„Ù…ÙŠØ­: Ø§Ø¨Ø¯Ø£ Ø¨Ø¬Ø¹Ù„ Ø§Ù„Ø­Ø§ÙˆÙŠØ© Flex Container Ù‚Ø¨Ù„ Ø£ÙŠ Ù…Ø­Ø§Ø°Ø§Ø© Ø£Ùˆ ØªÙˆØ²ÙŠØ¹.';
    case 'q2': return 'ØªÙ„Ù…ÙŠØ­: Ø±Ø§Ø¬Ø¹ ÙƒÙŠÙ ØªØºÙŠÙ‘Ø± Ø§ØªØ¬Ø§Ù‡ ØªØ±ØªÙŠØ¨ Ø§Ù„Ø¹Ù†Ø§ØµØ± Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø­ÙˆØ± Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ.';
    case 'q3': return 'ØªÙ„Ù…ÙŠØ­: Ø§Ù„Ù‡Ø¯Ù Ø£Ù† Ø§Ù„Ø¹Ù†Ø§ØµØ± Ù„Ø§ ØªÙ†Ø¶ØºØ· ÙÙŠ Ø³Ø·Ø± ÙˆØ§Ø­Ø¯ Ø¹Ù†Ø¯ Ø¶ÙŠÙ‚ Ø§Ù„Ø¹Ø±Ø¶.';
    case 'q4': return 'ØªÙ„Ù…ÙŠØ­: Ù‡Ø°Ø§ Ø§Ù„Ø³Ø¤Ø§Ù„ ÙŠØ¬Ù…Ø¹ â€œØ§ØªØ¬Ø§Ù‡â€ + â€œØ§Ù„ØªÙØ§Ùâ€ Ù…Ø¹Ù‹Ø§ Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ø®ØªØµØ§Ø±.';
    case 'q5': return 'ØªÙ„Ù…ÙŠØ­: Ø§Ù„Ù‡Ø¯Ù ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ù…Ø³Ø§ÙØ§Øª Ø¨ÙŠÙ† Ø§Ù„Ø¹Ù†Ø§ØµØ± Ø¹Ø¨Ø± Ø§Ù„Ù…Ø­ÙˆØ± Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ.';
    case 'q6': return 'ØªÙ„Ù…ÙŠØ­: Ù‡Ø°Ø§ Ø§Ù„Ø³Ø¤Ø§Ù„ Ø¹Ù† Ø§Ù„Ù…Ø­ÙˆØ± Ø§Ù„Ø¹Ø±Ø¶ÙŠ (Cross Axis) ÙˆÙ„ÙŠØ³ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ.';
    case 'q7': return 'ØªÙ„Ù…ÙŠØ­: ØºÙŠÙ‘Ø± ØªØ±ØªÙŠØ¨ Ø¹Ù†ØµØ± ÙˆØ§Ø­Ø¯ ÙÙ‚Ø· Ù„ÙŠØ¸Ù‡Ø± ÙÙŠ Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©.';
    case 'q8': return 'ØªÙ„Ù…ÙŠØ­: Ø­Ø¯Ù‘Ø¯ Ø­Ø¬Ù…Ù‹Ø§ Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠÙ‹Ø§ Ù„Ù„Ø¹Ù†Ø§ØµØ± Ø«Ù… Ø§Ø³Ù…Ø­ Ù„Ù‡Ø§ Ø¨Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ù„Ø³Ø·Ø± Ø¬Ø¯ÙŠØ¯.';
    case 'q9': return 'ØªÙ„Ù…ÙŠØ­: Ø§Ø¬Ø¹Ù„ Ø¹Ù†ØµØ±Ù‹Ø§ ÙŠØ­ØµÙ„ Ø¹Ù„Ù‰ Ù…Ø³Ø§Ø­Ø© Ø¥Ø¶Ø§ÙÙŠØ© Ù…Ù‚Ø§Ø±Ù†Ø© Ø¨Ø§Ù„Ø¢Ø®Ø±ÙŠÙ†.';
    case 'q10': return 'ØªÙ„Ù…ÙŠØ­: Ø§Ø¬Ø¹Ù„ Ø¹Ù†ØµØ±Ù‹Ø§ â€œØ«Ø§Ø¨ØªÙ‹Ø§â€ Ù„Ø§ ÙŠÙ†ÙƒÙ…Ø´ Ø¹Ù†Ø¯Ù…Ø§ ØªØµØºØ± Ø§Ù„Ø­Ø§ÙˆÙŠØ©.';
    case 'q11': return 'ØªÙ„Ù…ÙŠØ­: ØºÙŠÙ‘Ø± Ù…Ø­Ø§Ø°Ø§Ø© Ø¹Ù†ØµØ± ÙˆØ§Ø­Ø¯ ÙÙ‚Ø· Ø¨Ø´ÙƒÙ„ Ù…Ø³ØªÙ‚Ù„ Ø¹Ù† Ø§Ù„Ø¨Ù‚ÙŠØ©.';
    default: return 'ØªÙ„Ù…ÙŠØ­: Ø±Ø§Ø¬Ø¹ Ù…ØªØ·Ù„Ø¨Ø§Øª Ø§Ù„Ø³Ø¤Ø§Ù„.';
  }
}

function pxToNumber(px){
  const v = parseFloat(String(px).replace('px','').trim());
  return Number.isFinite(v) ? v : NaN;
}

/* âœ… Ù„Ø§ ØªÙ„Ù…ÙŠØ­ Ø¥Ù„Ø§ Ø¥Ø°Ø§ attempted */
function passFail(ok, id, title){
  const attempted = hasAttempted(id);
  return {
    ok, id, title, attempted,
    msg: ok ? 'âœ… ØªÙ….' : (attempted ? 'âŒ Ù„Ù… ÙŠØªÙ….' : 'Ù„Ù… ØªØªÙ… Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ø¨Ø¹Ø¯.'),
    hint: ok ? '' : (attempted ? generalHint(id) : ''),
    score: ok ? 1 : 0
  };
}

/* ===== Auto grader ===== */
function grade(){
  if (!iframeReady) return { items: [], total: 0, max: MAX };

  const doc = iframe.contentDocument;
  const get = (sel) => doc.querySelector(sel);
  const cs = (el) => el ? doc.defaultView.getComputedStyle(el) : null;

  const out = [];

  out.push(passFail(cs(get('.q1 .demo'))?.display === 'flex', 'q1', 'Ø³1 â€” ØªÙØ¹ÙŠÙ„ Flex'));
  out.push(passFail(cs(get('.q2 .demo'))?.flexDirection === 'column', 'q2', 'Ø³2 â€” ØªØºÙŠÙŠØ± Ø§Ù„Ø§ØªØ¬Ø§Ù‡'));
  out.push(passFail(cs(get('.q3 .demo'))?.flexWrap === 'wrap', 'q3', 'Ø³3 â€” Ø§Ù„ØªÙØ§Ù Ø§Ù„Ø¹Ù†Ø§ØµØ±'));

  { // q4 direction+wrap
    const s = cs(get('.q4 .demo'));
    const ok = s?.flexDirection === 'column' && s?.flexWrap === 'wrap';
    out.push(passFail(ok, 'q4', 'Ø³4 â€” Ø§Ø®ØªØµØ§Ø± Ø§ØªØ¬Ø§Ù‡+Ø§Ù„ØªÙØ§Ù'));
  }

  out.push(passFail(cs(get('.q5 .demo'))?.justifyContent === 'space-between', 'q5', 'Ø³5 â€” ØªÙˆØ²ÙŠØ¹ Ù…Ø³Ø§ÙØ§Øª'));
  out.push(passFail(cs(get('.q6 .demo'))?.alignItems === 'center', 'q6', 'Ø³6 â€” Ù…Ø­Ø§Ø°Ø§Ø© Ø¹Ø±Ø¶ÙŠØ©'));

  { // q7 order
    const demo = get('.q7 .demo');
    const items = demo ? demo.querySelectorAll('.item') : [];
    const o4 = items[3] ? parseInt(cs(items[3])?.order || '0', 10) : 0;
    const o1 = items[0] ? parseInt(cs(items[0])?.order || '0', 10) : 0;
    out.push(passFail(o4 < o1, 'q7', 'Ø³7 â€” ØªØºÙŠÙŠØ± ØªØ±ØªÙŠØ¨ Ø¹Ù†ØµØ±'));
  }

  { // q8 basis
    const item = get('.q8 .demo .item');
    const basis = cs(item)?.flexBasis || '';
    const n = pxToNumber(basis);
    out.push(passFail(Number.isFinite(n) && Math.abs(n - 180) <= 2, 'q8', 'Ø³8 â€” Ø­Ø¬Ù… Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠ'));
  }

  { // q9 grow
    const first = get('.q9 .demo .item.first');
    const g = parseFloat(cs(first)?.flexGrow || '0');
    out.push(passFail(Math.abs(g - 2) < 0.0001, 'q9', 'Ø³9 â€” Ø¹Ù†ØµØ± ÙŠØªÙ…Ø¯Ø¯ Ø£ÙƒØ«Ø±'));
  }

  { // q10 shrink
    const mid = get('.q10 .demo .item.mid');
    const sh = parseFloat(cs(mid)?.flexShrink || '1');
    out.push(passFail(Math.abs(sh - 0) < 0.0001, 'q10', 'Ø³10 â€” Ù…Ù†Ø¹ Ø§Ù„Ø§Ù†ÙƒÙ…Ø§Ø´'));
  }

  { // q11 align-self
    const sp = get('.q11 .demo .item.special');
    const as = cs(sp)?.alignSelf || 'auto';
    out.push(passFail(as === 'flex-end', 'q11', 'Ø³11 â€” Ù…Ø­Ø§Ø°Ø§Ø© Ø¹Ù†ØµØ± ÙˆØ§Ø­Ø¯'));
  }

  const total = out.reduce((s, x) => s + x.score, 0);
  return { items: out, total, max: MAX };
}

/* ===== Retry: reset block to starter ===== */
function resetOneQuestion(qid){
  const cur = cssInput.value;
  const def = starterCSS;
  const qb = questionBlocks.find(x => x.id === qid);
  if (!qb) return;

  const curB = extractBlock(cur, qb.start, qb.end);
  const defB = extractBlock(def, qb.start, qb.end);
  if (!curB || !defB) return;

  cssInput.value = cur.slice(0, curB.start) + defB.text + cur.slice(curB.end);
  applyAndRender();
}

/* ===== Render UI ===== */
function renderAll(items, total, max){
  const pct = max ? Math.round((total / max) * 100) : 0;
  scoreText.textContent = `${total}/${max}`;
  percentText.textContent = `${pct}%`;
  progressFill.style.width = `${pct}%`;

  chipsEl.innerHTML = '';
  for (const it of items){
    const chip = document.createElement('div');
    chip.className = `chip ${it.ok ? 'ok' : 'bad'}`;
    chip.title = it.ok ? 'ØªÙ…' : (it.attempted ? it.hint : 'Ù„Ù… ØªØªÙ… Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ø¨Ø¹Ø¯');
    chip.innerHTML = `<span class="dot"></span><span>${it.title}</span><b>${it.score}/1</b>`;
    chipsEl.appendChild(chip);
  }

  resultsEl.innerHTML = '';
  for (const it of items){
    const div = document.createElement('div');
    div.className = `r ${it.ok ? 'okBox' : 'badBox'}`;
    div.innerHTML = `
      <div class="top">
        <div>
          <div class="name">${it.title}</div>
          <div class="msg">${it.msg}</div>
          ${( !it.ok && it.attempted && it.hint )
            ? `<div class="msg" style="margin-top:6px;color:#cbd5e1"><b>ğŸ’¡ ${it.hint}</b></div>`
            : ``}
        </div>
        <div style="display:flex; gap:10px; align-items:flex-start; flex-wrap:wrap;">
          <div class="score">${it.score}/1</div>
          <button class="small danger" data-retry="${it.id}">Ø¥Ø¹Ø§Ø¯Ø© Ù…Ø­Ø§ÙˆÙ„Ø©</button>
        </div>
      </div>
    `;
    resultsEl.appendChild(div);
  }

  resultsEl.querySelectorAll('[data-retry]').forEach(btn => {
    btn.addEventListener('click', () => resetOneQuestion(btn.getAttribute('data-retry')));
  });
}

function applyAndRender(){
  apply();
  const g = grade();
  renderAll(g.items, g.total, g.max);
}

function scheduleLive(){
  if (!liveEnabled || !iframeReady) return;
  clearTimeout(debounceTimer);
  debounceTimer = setTimeout(() => applyAndRender(), 250);
}

/* ===== Controls ===== */
document.getElementById('btnApply').addEventListener('click', applyAndRender);
document.getElementById('btnCheck').addEventListener('click', applyAndRender);
document.getElementById('btnResetAll').addEventListener('click', () => { cssInput.value = starterCSS; applyAndRender(); });

autoToggle.addEventListener('click', () => {
  liveEnabled = !liveEnabled;
  autoToggle.classList.toggle('on', liveEnabled);
  if (liveEnabled) applyAndRender();
});

cssInput.addEventListener('input', scheduleLive);

/* âœ… start after iframe load */
iframe.addEventListener('load', () => {
  iframeReady = true;
  applyAndRender();
});

/* load iframe */
iframe.srcdoc = lockedHTML;
</script>

</body>
</html>
